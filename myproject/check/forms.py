from flask_wtf import FlaskForm
from wtforms import SubmitField, StringField
from flask_wtf.file import FileField, FileRequired
from wtforms.validators import DataRequired
from flask import flash

import os
import sys

sys.path.append(os.path.join(os.path.dirname(__file__), '..'))

from myproject.models import Malware, History, generate_file_hash

class SelectFileForm(FlaskForm):
    target_file = FileField('Choose your file', validators=[FileRequired()])
    submit = SubmitField("Let's check!")


class MalwareRegistrationForm(FlaskForm):
    malware_name = StringField('Malware Name', validators=[DataRequired()])
    malware_file = FileField('Choose Malware file', validators=[FileRequired()])
    submit = SubmitField('Register')

    def validate_malware_file(self, malware_file):
        target = generate_file_hash(self.malware_file.data.filename)

        if Malware.query.filter_by(malware_hash=target).first():
            flash('Malware hash has been registerd already!')